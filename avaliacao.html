<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>CheckInfra ‚Äì Avalia√ß√£o Sanit√°ria</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#1f4fd8">

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DD4SQ88NVT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DD4SQ88NVT');
</script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.header {
  background: #1f4fd8;
  color: #fff;
  padding: 14px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 18px;
  font-weight: bold;
}

.nav-left button,
.nav-left a {
  background: none;
  border: none;
  color: #fff;
  font-size: 20px;
  cursor: pointer;
  margin-right: 6px;
  text-decoration: none;
}

.container {
  max-width: 900px;
  margin: 20px auto;
  padding: 0 16px;
  flex: 1;
}

h1 { text-align: center; margin: 20px 0; }

.card {
  background: #fff;
  border-radius: 14px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 2px 6px rgba(0,0,0,.08);
}

.card-grande h3 { color: #1f4fd8; margin-bottom: 12px; }

.checklist {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.check-card {
  padding: 14px;
  border-radius: 12px;
  background: #fafafa;
  border: 2px solid #e0e0e0;
  cursor: pointer;
  transition: .2s;
}

.check-card:hover {
  transform: translateY(-2px);
}

.check-card.selected {
  border-color: #1f4fd8;
  background: #eaf0ff;
  font-weight: bold;
}

.upload-box {
  border: 2px dashed #bbb;
  border-radius: 14px;
  padding: 20px;
  text-align: center;
  background: #fcfcfc;
}

.upload-preview img {
  width: 100px;
  border-radius: 8px;
  margin: 6px;
}

button {
  width: 100%;
  padding: 16px;
  background: #1f4fd8;
  color: #fff;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
}

.resultado {
  padding: 20px;
  border-radius: 14px;
  font-weight: bold;
  display: none;
}

.resultado-ok { background: #d4edda; color: #155724; }
.resultado-alerta { background: #fff3cd; color: #856404; }
.resultado-critico { background: #f8d7da; color: #721c24; }

footer {
  background:#1f4fd8;
  color:#fff;
  text-align:center;
  padding:16px 10px;
  font-size:12px;
}
</style>
</head>

<body>

<div class="header">
  <div class="nav-left">
    <button onclick="history.back()">‚¨ÖÔ∏è</button>
    <a href="./index.html">üè†</a>
  </div>
  CheckInfra ‚Äì Avalia√ß√£o Sanit√°ria
</div>

<div class="container">
<h1>Avalia√ß√£o Sanit√°ria Escolar</h1>

<form id="form-avaliacao">

<div class="card">
  <label>Escola</label>
  <select id="escola" required>
    <option value="">Selecione a escola</option>
  </select>

  <label>Avaliador</label>
  <input type="text" id="avaliador" required>
</div>

<div class="card card-grande">
  <h3>üèóÔ∏è Estrutura</h3>
  <div class="checklist">
    <div class="check-card" data-peso="3">Mofo ou umidade excessiva</div>
    <div class="check-card" data-peso="2">Piso quebrado ou escorregadio</div>
    <div class="check-card" data-peso="2">Infiltra√ß√µes vis√≠veis</div>
  </div>
</div>

<div class="card card-grande">
  <h3>üßπ Higiene</h3>
  <div class="checklist">
    <div class="check-card" data-peso="2">Limpeza inadequada</div>
    <div class="check-card" data-peso="2">Mau cheiro persistente</div>
  </div>
</div>

<div class="card card-grande">
  <h3>üí° Conforto</h3>
  <div class="checklist">
    <div class="check-card" data-peso="1">Ilumina√ß√£o insuficiente</div>
    <div class="check-card" data-peso="1">Ventila√ß√£o inadequada</div>
  </div>
</div>

<button type="submit">Gerar Diagn√≥stico e PDF</button>
</form>

<div id="resultado" class="resultado"></div>

</div>

<footer>
  ¬© 2025 CheckInfra ‚Äî Projeto acad√™mico e tecnol√≥gico ‚Äî Licen√ßa MIT
</footer>

<script src="./mapa/escolas.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const select = document.getElementById("escola");
  window.escolas?.forEach(e => {
    const opt = document.createElement("option");
    opt.value = e.nome;
    opt.textContent = e.nome;
    select.appendChild(opt);
  });

  document.querySelectorAll(".check-card").forEach(card => {
    card.onclick = () => card.classList.toggle("selected");
  });

  const { jsPDF } = window.jspdf;
  const form = document.getElementById("form-avaliacao");
  const resultado = document.getElementById("resultado");

  form.onsubmit = e => {
    e.preventDefault();

    const id = "CI-" + Date.now();
    const avaliador = document.getElementById("avaliador").value;

    let pontuacao = 0;
    let problemas = [];

    document.querySelectorAll(".check-card.selected").forEach(c => {
      pontuacao += Number(c.dataset.peso);
      problemas.push(c.innerText);
    });

    let status = pontuacao >= 10 ? "critico" : pontuacao >= 6 ? "alerta" : "ok";

    resultado.style.display = "block";
    resultado.className = "resultado resultado-" + status;
    resultado.innerHTML = `
      <strong>IDCHECKINFRA:</strong> ${id}<br>
      <strong>Pontua√ß√£o:</strong> ${pontuacao}<br>
      <strong>Status:</strong> ${status.toUpperCase()}
    `;

    const historico = JSON.parse(localStorage.getItem("checkinfra") || "[]");
    historico.push({ id, avaliador, pontuacao, status, data: new Date() });
    localStorage.setItem("checkinfra", JSON.stringify(historico));

    const pdf = new jsPDF();
    pdf.text("CHECKINFRA ‚Äî AVALIA√á√ÉO SANIT√ÅRIA", 10, 10);
    pdf.text(`ID: ${id}`, 10, 20);
    pdf.text(`Avaliador: ${avaliador}`, 10, 30);
    pdf.text(`Pontua√ß√£o: ${pontuacao}`, 10, 40);
    pdf.text(`Status: ${status.toUpperCase()}`, 10, 50);
    pdf.text("Problemas:", 10, 60);
    problemas.forEach((p, i) => pdf.text(`- ${p}`, 10, 70 + i * 8));

    pdf.save(`CheckInfra_${id}.pdf`);
  };
});
</script>

</body>
</html>
