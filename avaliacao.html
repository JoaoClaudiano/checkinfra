<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Avaliação Sanitária</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{ font-family:Arial; background:#f4f6f8; padding:20px; }
section{
  background:#fff; padding:20px; border-radius:8px;
  margin-bottom:20px; box-shadow:0 2px 6px rgba(0,0,0,.1);
}
button{
  width:100%; padding:15px; background:#1f3a5f;
  color:#fff; border:none; border-radius:8px; font-size:16px;
}
.status{ display:flex; align-items:center; gap:10px; margin-top:20px; }
.bola{ width:16px; height:16px; border-radius:50%; }
.adequado .bola{ background:green; }
.alerta .bola{ background:orange; }
.critico .bola{ background:red; }
</style>
</head>

<body>

<section>
<h3>Identificação</h3>
<label>Escola</label>
<select id="escola" style="width:100%;padding:8px"></select>
</section>

<section>
<h3>Checklist Sanitário</h3>
<div><input type="checkbox" data-peso="3"> Presença de mofo</div>
<div><input type="checkbox" data-peso="2"> Piso quebrado</div>
<div><input type="checkbox" data-peso="2"> Vazamentos</div>
</section>

<section>
<h3>Registro Fotográfico</h3>
<input type="file" id="fotos" multiple>
</section>

<button onclick="avaliar()">Gerar Diagnóstico</button>
<div id="resultado"></div>

<script>
// carregar escolas
fetch("mapa/escolas.json")
.then(r=>r.json())
.then(lista=>{
  const sel=document.getElementById("escola");
  sel.innerHTML='<option value="">Selecione a escola</option>';
  lista.forEach(e=>{
    const o=document.createElement("option");
    o.value=e.nome;
    o.textContent=e.nome;
    sel.appendChild(o);
  });
});

// avaliação
function avaliar(){
  const escola=document.getElementById("escola").value;
  if(!escola){ alert("Selecione a escola"); return; }

  let pontos=0;
  document.querySelectorAll("input[type=checkbox]:checked")
    .forEach(c=>pontos+=Number(c.dataset.peso));

  if(document.getElementById("fotos").files.length>0) pontos+=2;

  let status="adequado";
  if(pontos>5) status="critico";
  else if(pontos>2) status="alerta";

  document.getElementById("resultado").innerHTML=`
    <div class="status ${status}">
      <span class="bola"></span>
      <strong>${status.toUpperCase()}</strong> — Pontuação: ${pontos}
    </div>
    <button onclick="gerarPDF('${escola}','${status}',${pontos})">
      Gerar PDF
    </button>
  `;

  salvarMapa(escola,status);
}

function salvarMapa(escola,status){
  let dados=JSON.parse(localStorage.getItem("avaliacoes"))||[];
  dados.push({escola,status,data:new Date().toLocaleDateString()});
  localStorage.setItem("avaliacoes",JSON.stringify(dados));
}

function gerarPDF(escola,status,pontos){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  pdf.text("Relatório de Avaliação Sanitária",20,20);
  pdf.text(Escola: ${escola},20,35);
  pdf.text(Status: ${status},20,45);
  pdf.text(Pontuação: ${pontos},20,55);
  pdf.text("Diagnóstico preliminar. Não substitui laudo técnico.",20,75);
  pdf.save("avaliacao.pdf");
}
</script>

</body>
</html>



