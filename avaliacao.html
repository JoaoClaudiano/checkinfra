<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Avalia√ß√£o Sanit√°ria ‚Äì Banheiros Escolares</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:20px;
}

.card {
  background:#fff;
  max-width:800px;
  margin:auto;
  padding:25px;
  border-radius:8px;
}

h2 {
  margin-bottom:10px;
}

.section {
  margin-top:25px;
}

label {
  font-weight:bold;
  display:block;
  margin-top:10px;
}

input[type="text"] {
  width:100%;
  padding:10px;
  margin-top:6px;
}

.group {
  margin-top:15px;
  padding:15px;
  border:1px solid #ddd;
  border-radius:6px;
}

.group-title {
  font-weight:bold;
  margin-bottom:10px;
}

.check {
  display:flex;
  align-items:center;
  gap:10px;
  margin-top:8px;
}

.check input {
  transform: scale(1.2);
}

button {
  margin-top:30px;
  width:100%;
  padding:15px;
  font-size:16px;
  background:#1f4fd8;
  color:#fff;
  border:none;
  border-radius:6px;
}

.resultado {
  margin-top:25px;
  padding:15px;
  border-radius:6px;
  display:none;
  font-weight:bold;
  text-align:center;
}

.ok { background:#d4edda; color:#155724; }
.alerta { background:#fff3cd; color:#856404; }
.critico { background:#f8d7da; color:#721c24; }
</style>
</head>

<body>

<div class="card">
<h2>Avalia√ß√£o Sanit√°ria dos Banheiros</h2>

<div class="section">
  <label>Escola</label>
  <input type="text" id="escola" list="listaEscolas" placeholder="Digite ou selecione a escola">
  <datalist id="listaEscolas"></datalist>
</div>

<div class="section">
  <label>Respons√°vel pela avalia√ß√£o</label>
  <input type="text" id="avaliador">
</div>

<div class="section">
  <div class="group">
    <div class="group-title">üß± Estrutura</div>
    <div class="check"><input type="checkbox" data-peso="2"> Piso danificado</div>
    <div class="check"><input type="checkbox" data-peso="1"> Revestimento solto</div>
    <div class="check"><input type="checkbox" data-peso="3"> Infiltra√ß√£o vis√≠vel</div>
  </div>

  <div class="group">
    <div class="group-title">üíß Hidrossanit√°rio</div>
    <div class="check"><input type="checkbox" data-peso="3"> Sanit√°rio ou torneira quebrada</div>
    <div class="check"><input type="checkbox" data-peso="2"> Vazamentos</div>
  </div>

  <div class="group">
    <div class="group-title">üå´Ô∏è Ambiente</div>
    <div class="check"><input type="checkbox" data-peso="4"> Mofo / bolor</div>
    <div class="check"><input type="checkbox" data-peso="2"> Mau cheiro</div>
    <div class="check"><input type="checkbox" data-peso="2"> Ventila√ß√£o inadequada</div>
    <div class="check"><input type="checkbox" data-peso="1"> Ilumina√ß√£o deficiente</div>
  </div>

  <div class="group">
    <div class="group-title">‚ôø Uso e seguran√ßa</div>
    <div class="check"><input type="checkbox" data-peso="2"> Falta de acessibilidade</div>
    <div class="check"><input type="checkbox" data-peso="1"> Porta sem tranca</div>
    <div class="check"><input type="checkbox" data-peso="2"> Drenagem inadequada</div>
  </div>
</div>

<button onclick="gerarDiagnostico()">Gerar diagn√≥stico e PDF</button>

<div id="resultado" class="resultado"></div>
</div>

<script src="./mapa/escolas.js"></script>

<script>
/* Preencher lista de escolas */
const lista = document.getElementById("listaEscolas");
if (window.escolas) {
  window.escolas.forEach(e => {
    const opt = document.createElement("option");
    opt.value = e.nome;
    lista.appendChild(opt);
  });
}

/* Diagn√≥stico t√©cnico */
function gerarDiagnostico() {
  const escola = document.getElementById("escola").value;
  if (!escola) {
    alert("Informe a escola");
    return;
  }

  let score = 0;
  document.querySelectorAll("input[type=checkbox]:checked")
    .forEach(cb => score += parseInt(cb.dataset.peso));

  let status = "Condi√ß√£o adequada", classe = "ok";
  if (score >= 9) { status = "Condi√ß√£o cr√≠tica"; classe = "critico"; }
  else if (score >= 4) { status = "Situa√ß√£o de alerta"; classe = "alerta"; }

  const r = document.getElementById("resultado");
  r.className = "resultado " + classe;
  r.style.display = "block";
  r.innerHTML = `Escola: ${escola}<br>Pontua√ß√£o t√©cnica: ${score}<br>Status: ${status}`;

  gerarPDF(escola, score, status);
}

/* PDF */
function gerarPDF(escola, score, status) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("Relat√≥rio de Avalia√ß√£o Sanit√°ria", 20, 20);
  doc.text(`Escola: ${escola}`, 20, 40);
  doc.text(`Pontua√ß√£o t√©cnica: ${score}`, 20, 50);
  doc.text(`Status: ${status}`, 20, 60);
  doc.text(`Data: ${new Date().toLocaleDateString()}`, 20, 70);
  doc.save(`avaliacao_${escola}.pdf`);
}
</script>

</body>
</html>
