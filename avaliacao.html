<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>CheckInfra ‚Äî Avalia√ß√£o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- estilos j√° existentes -->
  <link rel="stylesheet" href="style.css" />

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>

<header class="header">
  <nav class="nav">
    <div class="nav-left">
      <a href="index.html" class="nav-btn">‚¨ÖÔ∏è</a>
      <a href="index.html" class="nav-btn">üè†</a>
    </div>
    <h1>CheckInfra</h1>
  </nav>
</header>

<main class="container">

  <section class="info">
    <h2 id="nomeEscola">Escola Municipal</h2>
    <p id="nomeAvaliador">Avaliador: ‚Äî</p>
  </section>

  <form id="formAvaliacao">

    <!-- CARDS VERTICAIS (mantidos) -->
    <section class="cards">

      <label class="card">
        <input type="checkbox" value="1">
        Instala√ß√µes el√©tricas inadequadas
      </label>

      <label class="card">
        <input type="checkbox" value="1">
        Vazamentos ou infiltra√ß√µes
      </label>

      <label class="card">
        <input type="checkbox" value="1">
        Banheiros sem condi√ß√µes de uso
      </label>

      <label class="card">
        <input type="checkbox" value="1">
        Problemas estruturais vis√≠veis
      </label>

      <label class="card">
        <input type="checkbox" value="1">
        Falta de acessibilidade
      </label>

      <label class="card">
        <input type="checkbox" value="1">
        Ilumina√ß√£o insuficiente
      </label>

      <label class="card">
        <input type="checkbox" value="1">
        Ventila√ß√£o inadequada
      </label>

      <label class="card">
        <input type="checkbox" value="1">
        Risco sanit√°rio identificado
      </label>

      <label class="card">
        <input type="checkbox" value="1">
        Risco imediato √† seguran√ßa
      </label>

    </section>

    <button type="submit" class="btn">Finalizar Avalia√ß√£o</button>
  </form>

  <!-- CARD FINAL DE DIAGN√ìSTICO -->
  <section id="resultado" class="resultado" style="display:none;"></section>

</main>

<footer class="footer">
  <p>CheckInfra ‚Äî Ferramenta de apoio √† decis√£o t√©cnica</p>
</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const form = document.getElementById("formAvaliacao");
  const resultado = document.getElementById("resultado");

  const escola = localStorage.getItem("escola") || "Escola Municipal";
  const avaliador = localStorage.getItem("avaliador") || "N√£o informado";

  document.getElementById("nomeEscola").textContent = escola;
  document.getElementById("nomeAvaliador").textContent = "Avaliador: " + avaliador;

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    let pontuacao = 0;
    document.querySelectorAll("input[type='checkbox']:checked")
      .forEach(c => pontuacao += Number(c.value));

    let classe = "", texto = "", icone = "";

    if (pontuacao <= 3) {
      classe = "verde";
      texto = "Condi√ß√£o adequada";
      icone = "üü¢";
    } else if (pontuacao <= 6) {
      classe = "amarelo";
      texto = "Situa√ß√£o de alerta";
      icone = "üü°";
    } else if (pontuacao <= 8) {
      classe = "laranja";
      texto = "Aten√ß√£o elevada";
      icone = "üü†";
    } else {
      classe = "vermelho";
      texto = "Condi√ß√£o cr√≠tica";
      icone = "üî¥";
    }

    resultado.className = `resultado resultado-${classe}`;
    resultado.style.display = "block";

    resultado.innerHTML = `
      <div class="selo selo-${classe}">
        ${icone} ${texto}
      </div>
      <strong>Escola:</strong> ${escola}<br>
      <strong>Avaliador:</strong> ${avaliador}<br>
      <strong>Pontua√ß√£o:</strong> ${pontuacao}<br>
      ${navigator.onLine ? "‚òÅÔ∏è Enviado" : "üì¥ Salvo offline"}
    `;

    // PDF
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    pdf.text("CheckInfra ‚Äî Diagn√≥stico", 10, 10);
    pdf.text(`Escola: ${escola}`, 10, 20);
    pdf.text(`Avaliador: ${avaliador}`, 10, 30);
    pdf.text(`Pontua√ß√£o: ${pontuacao}`, 10, 40);
    pdf.text(`Status: ${texto}`, 10, 50);
    pdf.save("diagnostico_checkinfra.pdf");

    // redirecionamento ap√≥s 4s
    setTimeout(() => {
      window.location.href = "index.html";
    }, 4000);

    form.reset();
  });

});
</script>

</body>
</html>
